@inject ChannelManager channelManager;

@{
    var Model = channelManager.RecentlyCompletedJobs;
}
<div>
    <h2>Kürzlich gesucht</h2>
    <table class="table table-striped">
        <thead>
            <tr>
                <td>&nbsp;</td>
                <td>Datum (UTC)</td>
                <td>Produkt</td>
                <td>Ergebnis</td>
            </tr>
        </thead>
        <tbody>
            @if (Model.Count == 0)
            {
                <tr>
                    <td colspan="99">Sobald Ergebnisse vorliegen, werden diese hier angezeigt.</td>
                </tr>
            }
            @foreach (var item in Model)
            {
                var id = "result-" + item.Id.ToString("N");
                <tr>
                    <td width="10%">
                        @if (!string.IsNullOrWhiteSpace(item.ProductImageUrl))
                        {
                            <img class="img-fluid" style="max-height: 100px;" src="@item.ProductImageUrl" />
                        }
                    </td>
                    <td style="white-space: nowrap;">@item.TimeCreated.ToString(Configuration.Instance.DateFormat)</td>
                    <td>@(item.ProductName ?? item.CrawlUrl.ToString())</td>
                    <td>
                        @if (item.Success)
                        {
                            <button class="btn btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#@id" aria-expanded="false" aria-controls="@id">Anzeigen</button>
                        } else
                        {
                            <span>ERROR</span>
                        }
                    </td>
                </tr>
                <tr class="collapse" id="@id">
                    <td colspan="99">
                        @Html.Raw(item.ResultTableHtml)
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>